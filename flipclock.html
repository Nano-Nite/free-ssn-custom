<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixel-Perfect Flip Clock</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        width: 900px;
        height: auto;
      }

      .countdown {
        /* margin: 100px auto; */
        width: 100%;
        display: flex;
        gap: 13px;
        font-family: sans-serif;

        /* border: 4px solid black; */
        padding: 4% 6%;
        border-radius: 75px;
        align-items: center;
      }

      .time-section {
        text-align: center;
        font-size: 30px;
      }

      .time-group {
        display: flex;
        gap: 10px;
      }

      .time-segment {
        display: block;
        font-size: 100px;
        font-weight: 900;
        width: 100px;
      }

      .segment-display {
        position: relative;
        height: 100%;
      }

      .segment-display__top,
      .segment-display__bottom {
        overflow: hidden;
        text-align: center;
        width: 100%;
        height: 50%;
        position: relative;
      }

      .segment-display__top {
        line-height: 1.5;
        color: #d70000;
        background-color: #111;
      }

      .segment-display__bottom {
        line-height: 0;
        color: red;
        background-color: #272727;
      }

      .segment-overlay {
        position: absolute;
        top: 0;
        perspective: 400px;
        height: 100%;
        width: 100px;
      }

      .segment-overlay__top,
      .segment-overlay__bottom {
        position: absolute;
        overflow: hidden;
        text-align: center;
        width: 100%;
        height: 50%;
      }

      .segment-overlay__top {
        top: 0;
        line-height: 1.5;
        color: #d70000;
        background-color: #111;
        transform-origin: bottom;
      }

      .segment-overlay__bottom {
        bottom: 0;
        line-height: 0;
        color: red;
        background-color: #333;
        border-top: 2px solid #555;
        transform-origin: top;
      }

      .segment-overlay.flip .segment-overlay__top {
        animation: flip-top 0.8s linear;
      }

      .segment-overlay.flip .segment-overlay__bottom {
        animation: flip-bottom 0.8s linear;
      }

      .sep {
        font-size: 50px;
        color: #555;
      }

      @keyframes flip-top {
        0% {
          transform: rotateX(0deg);
        }
        50%,
        100% {
          transform: rotateX(-90deg);
        }
      }

      @keyframes flip-bottom {
        0%,
        50% {
          transform: rotateX(90deg);
        }
        100% {
          transform: rotateX(0deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="countdown">
      <div class="time-section" id="hours">
        <div class="time-group">
          <div class="time-segment">
            <div class="segment-display">
              <div class="segment-display__top"></div>
              <div class="segment-display__bottom"></div>
              <div class="segment-overlay">
                <div class="segment-overlay__top"></div>
                <div class="segment-overlay__bottom"></div>
              </div>
            </div>
          </div>
          <div class="time-segment">
            <div class="segment-display">
              <div class="segment-display__top"></div>
              <div class="segment-display__bottom"></div>
              <div class="segment-overlay">
                <div class="segment-overlay__top"></div>
                <div class="segment-overlay__bottom"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- <p>Hours</p> -->
      </div>
      <div class="sep">:</div>
      <div class="time-section" id="minutes">
        <div class="time-group">
          <div class="time-segment">
            <div class="segment-display">
              <div class="segment-display__top"></div>
              <div class="segment-display__bottom"></div>
              <div class="segment-overlay">
                <div class="segment-overlay__top"></div>
                <div class="segment-overlay__bottom"></div>
              </div>
            </div>
          </div>
          <div class="time-segment">
            <div class="segment-display">
              <div class="segment-display__top"></div>
              <div class="segment-display__bottom"></div>
              <div class="segment-overlay">
                <div class="segment-overlay__top"></div>
                <div class="segment-overlay__bottom"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- <p>Minutes</p> -->
      </div>
      <div class="sep">:</div>
      <div class="time-section" id="seconds">
        <div class="time-group">
          <div class="time-segment">
            <div class="segment-display">
              <div class="segment-display__top"></div>
              <div class="segment-display__bottom"></div>
              <div class="segment-overlay">
                <div class="segment-overlay__top"></div>
                <div class="segment-overlay__bottom"></div>
              </div>
            </div>
          </div>
          <div class="time-segment">
            <div class="segment-display">
              <div class="segment-display__top"></div>
              <div class="segment-display__bottom"></div>
              <div class="segment-overlay">
                <div class="segment-overlay__top"></div>
                <div class="segment-overlay__bottom"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- <p>Seconds</p> -->
      </div>
    </div>
    <script>
      const params = new URLSearchParams(window.location.search);
      const MODE = params.get("mode") || "clock"; // clock | countdown
      const COUNTDOWN_MINUTES = parseInt(params.get("minutes"), 10) || 0;

      let countdownTarget = null;

      if (MODE === "countdown" && COUNTDOWN_MINUTES > 0) {
        countdownTarget = Date.now() + COUNTDOWN_MINUTES * 60 * 1000;
      }

      function getTimeSegmentElements(segmentElement) {
        const segmentDisplay = segmentElement.querySelector(".segment-display");
        return {
          segmentDisplayTop: segmentDisplay.querySelector(
            ".segment-display__top"
          ),
          segmentDisplayBottom: segmentDisplay.querySelector(
            ".segment-display__bottom"
          ),
          segmentOverlay: segmentDisplay.querySelector(".segment-overlay"),
          segmentOverlayTop: segmentDisplay.querySelector(
            ".segment-overlay__top"
          ),
          segmentOverlayBottom: segmentDisplay.querySelector(
            ".segment-overlay__bottom"
          ),
        };
      }

      function updateSegmentValues(displayElement, overlayElement, value) {
        displayElement.textContent = value;
        overlayElement.textContent = value;
      }

      function updateTimeSegment(segmentElement, timeValue) {
        const seg = getTimeSegmentElements(segmentElement);

        if (parseInt(seg.segmentDisplayTop.textContent, 10) === timeValue)
          return;

        seg.segmentOverlay.classList.add("flip");

        updateSegmentValues(
          seg.segmentDisplayTop,
          seg.segmentOverlayBottom,
          timeValue
        );

        function finishAnimation() {
          seg.segmentOverlay.classList.remove("flip");
          updateSegmentValues(
            seg.segmentDisplayBottom,
            seg.segmentOverlayTop,
            timeValue
          );
          this.removeEventListener("animationend", finishAnimation);
        }

        seg.segmentOverlay.addEventListener("animationend", finishAnimation);
      }

      function updateTimeSection(sectionID, timeValue) {
        const first = Math.floor(timeValue / 10) || 0;
        const second = timeValue % 10 || 0;
        const section = document.getElementById(sectionID);
        const segments = section.querySelectorAll(".time-segment");

        updateTimeSegment(segments[0], first);
        updateTimeSegment(segments[1], second);
      }

      function getTimeRemaining(target) {
        const now = Date.now();
        const diff = Math.max(0, target - now);

        const totalSeconds = Math.floor(diff / 1000);
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;

        return { hours, minutes, seconds, done: diff === 0 };
      }

      function updateAllSegments() {
        if (MODE === "countdown" && countdownTarget) {
          const t = getTimeRemaining(countdownTarget);

          updateTimeSection("hours", t.hours);
          updateTimeSection("minutes", t.minutes);
          updateTimeSection("seconds", t.seconds);

          return t.done;
        }

        // CLOCK MODE (DEFAULT)
        const now = new Date();
        updateTimeSection("hours", now.getHours());
        updateTimeSection("minutes", now.getMinutes());
        updateTimeSection("seconds", now.getSeconds());
        return false;
      }

      updateAllSegments();

      const timer = setInterval(() => {
        const done = updateAllSegments();
        if (done) clearInterval(timer);
      }, 1000);
    </script>
  </body>
</html>
